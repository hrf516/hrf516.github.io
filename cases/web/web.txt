import React, { useState } from 'react';
import { Search, CheckCircle, XCircle, Zap, Database, Layout, Cpu, ChevronLeft, ChevronRight, Layers, Aperture, ArrowDown } from 'lucide-react';

// --- 配置与说明 ---
// 如何替换为你自己的图片：
// 1. 将你的实验结果图片放入项目的 public 文件夹（例如 public/results/）
// 2. 在下方的 CASES 数据结构中，修改 createResult 函数的最后一个参数。
//    例如：createResult(..., '/results/case1_baseline_top1.jpg')

const BASELINE_MODELS = [
  { id: 'clip-base', name: 'CLIP ViT-B/32', description: 'Standard Zero-shot' },
  { id: 'clip-large', name: 'CLIP ViT-L/14', description: 'Large Scale Pre-train' },
  { id: 'blip', name: 'BLIP-2', description: 'VLP Framework' }
];

/**
 * 构建单个结果对象的辅助函数
 * @param {string} id - 唯一ID
 * @param {string} label - 显示的标签/类别（如 "Lung Opacity"）
 * @param {number} score - 相似度分数 (0.0 - 1.0)
 * @param {boolean} isRelevant - 是否相关（决定是对勾还是叉号）
 * @param {string} imageSrc - 图片路径 (本地路径 '/img/...' 或 远程 URL 'http://...')
 */
const createResult = (id, label, score, isRelevant, imageSrc) => ({
  id, 
  src: imageSrc, 
  score, 
  label,
  isRelevant
});

const CASES = [
  {
    id: 'medical',
    domain: "Medical Imaging",
    icon: Zap,
    queries: [
      {
        id: 'q1',
        type: "Text-to-Image",
        text: "Pneumonia consolidation in the upper right lobe",
        desc: "针对肺炎病灶的精细化检索测试。",
        // 如果你有 Query 图片，也可以在这里替换
        queryImage: "", 
        results: {
          'clip-base': {
            baseline: [
              // 替换下方的 URL 为你的图片路径
              createResult('cb1', 'General Lung', 0.62, false, 'https://images.unsplash.com/photo-1530497610245-94d3c16cda28?auto=format&fit=crop&w=400&q=80'),
              createResult('cb2', 'Lab Coat', 0.55, false, 'https://images.unsplash.com/photo-1579684385127-1ef15d508118?auto=format&fit=crop&w=400&q=80'),
              createResult('cb3', 'X-Ray', 0.51, true, 'https://images.unsplash.com/photo-1584036561566-b938f493336c?auto=format&fit=crop&w=400&q=80'),
              createResult('cb4', 'CT Scan', 0.49, false, 'https://images.unsplash.com/photo-1559757137-a5e2843a68e8?auto=format&fit=crop&w=400&q=80'),
              createResult('cb5', 'Hospital', 0.45, false, 'https://images.unsplash.com/photo-1519494056809-a292fad67707?auto=format&fit=crop&w=400&q=80')
            ],
            ours: [
              // 你的模型结果
              createResult('cbo1', 'Pathology Match', 0.88, true, 'https://images.unsplash.com/photo-1584036561566-b938f493336c?auto=format&fit=crop&w=400&q=80'),
              createResult('cbo2', 'Right Lobe Focus', 0.85, true, 'https://images.unsplash.com/photo-1532187863486-abf9dbad1b69?auto=format&fit=crop&w=400&q=80'),
              createResult('cbo3', 'Consolidation', 0.82, true, 'https://images.unsplash.com/photo-1516549655169-df83a092fc72?auto=format&fit=crop&w=400&q=80'),
              createResult('cbo4', 'Lung Detail', 0.80, true, 'https://images.unsplash.com/photo-1530497610245-94d3c16cda28?auto=format&fit=crop&w=400&q=80'),
              createResult('cbo5', 'Related Case', 0.78, true, 'https://images.unsplash.com/photo-1559757137-a5e2843a68e8?auto=format&fit=crop&w=400&q=80')
            ]
          },
          'clip-large': {
            baseline: [
              createResult('cl1', 'X-Ray Generic', 0.71, true, 'https://images.unsplash.com/photo-1584036561566-b938f493336c?auto=format&fit=crop&w=400&q=80'),
              createResult('cl2', 'Chest Scan', 0.65, true, 'https://images.unsplash.com/photo-1559757137-a5e2843a68e8?auto=format&fit=crop&w=400&q=80'),
              createResult('cl3', 'Hospital Bed', 0.58, false, 'https://images.unsplash.com/photo-1519494056809-a292fad67707?auto=format&fit=crop&w=400&q=80'),
              createResult('cl4', 'Doctor', 0.55, false, 'https://images.unsplash.com/photo-1622253692010-333f2da6031d?auto=format&fit=crop&w=400&q=80'),
              createResult('cl5', 'Medical', 0.52, false, 'https://images.unsplash.com/photo-1581594693702-fbdc51b2763b?auto=format&fit=crop&w=400&q=80')
            ],
            ours: [
              createResult('clo1', 'Pathology Match', 0.94, true, 'https://images.unsplash.com/photo-1584036561566-b938f493336c?auto=format&fit=crop&w=400&q=80'),
              createResult('clo2', 'Right Lobe Focus', 0.91, true, 'https://images.unsplash.com/photo-1532187863486-abf9dbad1b69?auto=format&fit=crop&w=400&q=80'),
              createResult('clo3', 'Precise Region', 0.89, true, 'https://images.unsplash.com/photo-1516549655169-df83a092fc72?auto=format&fit=crop&w=400&q=80'),
              createResult('clo4', 'High Conf', 0.87, true, 'https://images.unsplash.com/photo-1530497610245-94d3c16cda28?auto=format&fit=crop&w=400&q=80'),
              createResult('clo5', 'Structure', 0.85, true, 'https://images.unsplash.com/photo-1559757137-a5e2843a68e8?auto=format&fit=crop&w=400&q=80')
            ]
          },
          'blip': {
            baseline: [
              createResult('bp1', 'X-Ray Clear', 0.75, true, 'https://images.unsplash.com/photo-1584036561566-b938f493336c?auto=format&fit=crop&w=400&q=80'),
              createResult('bp2', 'Doctor', 0.60, false, 'https://images.unsplash.com/photo-1622253692010-333f2da6031d?auto=format&fit=crop&w=400&q=80'),
              createResult('bp3', 'Medical Tool', 0.55, false, 'https://images.unsplash.com/photo-1581594693702-fbdc51b2763b?auto=format&fit=crop&w=400&q=80'),
              createResult('bp4', 'Generic', 0.52, false, 'https://images.unsplash.com/photo-1579684385127-1ef15d508118?auto=format&fit=crop&w=400&q=80'),
              createResult('bp5', 'Scan', 0.48, true, 'https://images.unsplash.com/photo-1559757137-a5e2843a68e8?auto=format&fit=crop&w=400&q=80')
            ],
            ours: [
              createResult('bpo1', 'Structural Match', 0.96, true, 'https://images.unsplash.com/photo-1584036561566-b938f493336c?auto=format&fit=crop&w=400&q=80'),
              createResult('bpo2', 'Lesion Detection', 0.93, true, 'https://images.unsplash.com/photo-1532187863486-abf9dbad1b69?auto=format&fit=crop&w=400&q=80'),
              createResult('bpo3', 'Medical Context', 0.90, true, 'https://images.unsplash.com/photo-1516549655169-df83a092fc72?auto=format&fit=crop&w=400&q=80'),
              createResult('bpo4', 'Right Lobe', 0.88, true, 'https://images.unsplash.com/photo-1530497610245-94d3c16cda28?auto=format&fit=crop&w=400&q=80'),
              createResult('bpo5', 'Diagnosis', 0.86, true, 'https://images.unsplash.com/photo-1559757137-a5e2843a68e8?auto=format&fit=crop&w=400&q=80')
            ]
          }
        }
      },
      {
        id: 'q2',
        type: "Text-to-Image",
        text: "Fracture of the distal radius bone",
        desc: "测试模型对骨骼特定部位骨折的理解能力。",
        results: {
          'clip-base': {
            baseline: [
              createResult('cb1', 'Hand Shape', 0.58, false, 'https://images.unsplash.com/photo-1613918108466-392113e1b963?auto=format&fit=crop&w=400&q=80'),
              createResult('cb2', 'Arm', 0.52, false, 'https://images.unsplash.com/photo-1527101898812-c54555f1c456?auto=format&fit=crop&w=400&q=80'),
              createResult('cb3', 'Skeleton Model', 0.48, false, 'https://images.unsplash.com/photo-1515455183297-e03f06744910?auto=format&fit=crop&w=400&q=80'),
              createResult('cb4', 'Drawing', 0.45, false, 'https://images.unsplash.com/photo-1589182373726-e4f658ab50f0?auto=format&fit=crop&w=400&q=80'),
              createResult('cb5', 'Generic', 0.41, false, 'https://images.unsplash.com/photo-1530497610245-94d3c16cda28?auto=format&fit=crop&w=400&q=80')
            ],
            ours: [
              createResult('cbo1', 'Wrist Bone', 0.85, true, 'https://images.unsplash.com/photo-1552196563-55cd4e45efb3?auto=format&fit=crop&w=400&q=80'),
              createResult('cbo2', 'Fracture', 0.81, true, 'https://images.unsplash.com/photo-1584036561566-b938f493336c?auto=format&fit=crop&w=400&q=80'),
              createResult('cbo3', 'X-Ray Hand', 0.79, true, 'https://images.unsplash.com/photo-1532187863486-abf9dbad1b69?auto=format&fit=crop&w=400&q=80'),
              createResult('cbo4', 'Radius', 0.77, true, 'https://images.unsplash.com/photo-1589182373726-e4f658ab50f0?auto=format&fit=crop&w=400&q=80'),
              createResult('cbo5', 'Bone', 0.75, true, 'https://images.unsplash.com/photo-1515455183297-e03f06744910?auto=format&fit=crop&w=400&q=80')
            ]
          },
          'clip-large': {
            baseline: [
              createResult('cl1', 'Hand X-ray', 0.68, true, 'https://images.unsplash.com/photo-1552196563-55cd4e45efb3?auto=format&fit=crop&w=400&q=80'),
              createResult('cl2', 'Generic Bone', 0.64, false, 'https://images.unsplash.com/photo-1530497610245-94d3c16cda28?auto=format&fit=crop&w=400&q=80'),
              createResult('cl3', 'Finger', 0.61, false, 'https://images.unsplash.com/photo-1589182373726-e4f658ab50f0?auto=format&fit=crop&w=400&q=80'),
              createResult('cl4', 'Skeleton', 0.58, false, 'https://images.unsplash.com/photo-1515455183297-e03f06744910?auto=format&fit=crop&w=400&q=80'),
              createResult('cl5', 'Arm', 0.55, false, 'https://images.unsplash.com/photo-1527101898812-c54555f1c456?auto=format&fit=crop&w=400&q=80')
            ],
            ours: [
              createResult('clo1', 'Distal Radius', 0.95, true, 'https://images.unsplash.com/photo-1552196563-55cd4e45efb3?auto=format&fit=crop&w=400&q=80'),
              createResult('clo2', 'Bone Break', 0.92, true, 'https://images.unsplash.com/photo-1584036561566-b938f493336c?auto=format&fit=crop&w=400&q=80'),
              createResult('clo3', 'Orthopedic', 0.89, true, 'https://images.unsplash.com/photo-1532187863486-abf9dbad1b69?auto=format&fit=crop&w=400&q=80'),
              createResult('clo4', 'Trauma', 0.87, true, 'https://images.unsplash.com/photo-1613918108466-392113e1b963?auto=format&fit=crop&w=400&q=80'),
              createResult('clo5', 'Fracture', 0.85, true, 'https://images.unsplash.com/photo-1589182373726-e4f658ab50f0?auto=format&fit=crop&w=400&q=80')
            ]
          },
          'blip': {
            baseline: [
              createResult('bp1', 'Wrist X-ray', 0.72, true, 'https://images.unsplash.com/photo-1584036561566-b938f493336c?auto=format&fit=crop&w=400&q=80'),
              createResult('bp2', 'Orthopedic', 0.66, true, 'https://images.unsplash.com/photo-1552196563-55cd4e45efb3?auto=format&fit=crop&w=400&q=80'),
              createResult('bp3', 'Surgeon', 0.55, false, 'https://images.unsplash.com/photo-1576091160399-112ba8d25d1d?auto=format&fit=crop&w=400&q=80'),
              createResult('bp4', 'Cast', 0.52, false, 'https://images.unsplash.com/photo-1527101898812-c54555f1c456?auto=format&fit=crop&w=400&q=80'),
              createResult('bp5', 'Hand', 0.50, false, 'https://images.unsplash.com/photo-1613918108466-392113e1b963?auto=format&fit=crop&w=400&q=80')
            ],
            ours: [
              createResult('bpo1', 'Specific Fracture', 0.96, true, 'https://images.unsplash.com/photo-1552196563-55cd4e45efb3?auto=format&fit=crop&w=400&q=80'),
              createResult('bpo2', 'Radiography', 0.94, true, 'https://images.unsplash.com/photo-1584036561566-b938f493336c?auto=format&fit=crop&w=400&q=80'),
              createResult('bpo3', 'Bone Detail', 0.91, true, 'https://images.unsplash.com/photo-1532187863486-abf9dbad1b69?auto=format&fit=crop&w=400&q=80'),
              createResult('bpo4', 'Break', 0.89, true, 'https://images.unsplash.com/photo-1589182373726-e4f658ab50f0?auto=format&fit=crop&w=400&q=80'),
              createResult('bpo5', 'Orthopedic', 0.88, true, 'https://images.unsplash.com/photo-1515455183297-e03f06744910?auto=format&fit=crop&w=400&q=80')
            ]
          }
        }
      }
    ]
  },
  {
    id: 'remote',
    domain: "Remote Sensing",
    icon: Layout,
    queries: [
      {
        id: 'q1',
        type: "Image-to-Image",
        queryImage: "https://images.unsplash.com/photo-1524661135-423995f22d0b?auto=format&fit=crop&w=400&q=80",
        text: "Retrieve similar dense urban residential areas",
        desc: "密集城区检索：需区分普通夜景与卫星俯视图。",
        results: {
          'clip-base': {
            baseline: [
              createResult('cb1', 'Map Graphic', 0.65, false, 'https://images.unsplash.com/photo-1569336415962-a4bd9f69cd83?auto=format&fit=crop&w=400&q=80'),
              createResult('cb2', 'City Night', 0.61, false, 'https://images.unsplash.com/photo-1477959858617-67f85cf4f1df?auto=format&fit=crop&w=400&q=80'),
              createResult('cb3', 'Street View', 0.59, false, 'https://images.unsplash.com/photo-1480714378408-67cf0d13bc1b?auto=format&fit=crop&w=400&q=80'),
              createResult('cb4', 'Traffic', 0.55, false, 'https://images.unsplash.com/photo-1519501025264-65ba15a82390?auto=format&fit=crop&w=400&q=80'),
              createResult('cb5', 'Building', 0.52, false, 'https://images.unsplash.com/photo-1444723121867-7a241cacace9?auto=format&fit=crop&w=400&q=80')
            ],
            ours: [
              createResult('cbo1', 'Urban Density', 0.88, true, 'https://images.unsplash.com/photo-1477959858617-67f85cf4f1df?auto=format&fit=crop&w=400&q=80'),
              createResult('cbo2', 'Aerial View', 0.85, true, 'https://images.unsplash.com/photo-1519501025264-65ba15a82390?auto=format&fit=crop&w=400&q=80'),
              createResult('cbo3', 'City Block', 0.82, true, 'https://images.unsplash.com/photo-1444723121867-7a241cacace9?auto=format&fit=crop&w=400&q=80'),
              createResult('cbo4', 'Grid', 0.80, true, 'https://images.unsplash.com/photo-1524661135-423995f22d0b?auto=format&fit=crop&w=400&q=80'),
              createResult('cbo5', 'Resi Area', 0.78, true, 'https://images.unsplash.com/photo-1569336415962-a4bd9f69cd83?auto=format&fit=crop&w=400&q=80')
            ]
          },
          'clip-large': {
            baseline: [
              createResult('cl1', 'Aerial City', 0.78, true, 'https://images.unsplash.com/photo-1477959858617-67f85cf4f1df?auto=format&fit=crop&w=400&q=80'),
              createResult('cl2', 'Skyline', 0.68, false, 'https://images.unsplash.com/photo-1480714378408-67cf0d13bc1b?auto=format&fit=crop&w=400&q=80'),
              createResult('cl3', 'Night Lights', 0.65, false, 'https://images.unsplash.com/photo-1519501025264-65ba15a82390?auto=format&fit=crop&w=400&q=80'),
              createResult('cl4', 'Abstract', 0.60, false, 'https://images.unsplash.com/photo-1569336415962-a4bd9f69cd83?auto=format&fit=crop&w=400&q=80'),
              createResult('cl5', 'Roads', 0.58, false, 'https://images.unsplash.com/photo-1444723121867-7a241cacace9?auto=format&fit=crop&w=400&q=80')
            ],
            ours: [
              createResult('clo1', 'Dense Residential', 0.92, true, 'https://images.unsplash.com/photo-1477959858617-67f85cf4f1df?auto=format&fit=crop&w=400&q=80'),
              createResult('clo2', 'Structural Match', 0.88, true, 'https://images.unsplash.com/photo-1519501025264-65ba15a82390?auto=format&fit=crop&w=400&q=80'),
              createResult('clo3', 'Zoning Match', 0.85, true, 'https://images.unsplash.com/photo-1444723121867-7a241cacace9?auto=format&fit=crop&w=400&q=80'),
              createResult('clo4', 'Housing', 0.84, true, 'https://images.unsplash.com/photo-1524661135-423995f22d0b?auto=format&fit=crop&w=400&q=80'),
              createResult('clo5', 'Grid View', 0.81, true, 'https://images.unsplash.com/photo-1477959858617-67f85cf4f1df?auto=format&fit=crop&w=400&q=80')
            ]
          },
          'blip': {
            baseline: [
              createResult('bp1', 'Satellite View', 0.80, true, 'https://images.unsplash.com/photo-1477959858617-67f85cf4f1df?auto=format&fit=crop&w=400&q=80'),
              createResult('bp2', 'Urban Grid', 0.72, true, 'https://images.unsplash.com/photo-1444723121867-7a241cacace9?auto=format&fit=crop&w=400&q=80'),
              createResult('bp3', 'Google Maps', 0.60, false, 'https://images.unsplash.com/photo-1524661135-423995f22d0b?auto=format&fit=crop&w=400&q=80'),
              createResult('bp4', 'Road Map', 0.58, false, 'https://images.unsplash.com/photo-1569336415962-a4bd9f69cd83?auto=format&fit=crop&w=400&q=80'),
              createResult('bp5', 'City', 0.55, false, 'https://images.unsplash.com/photo-1480714378408-67cf0d13bc1b?auto=format&fit=crop&w=400&q=80')
            ],
            ours: [
              createResult('bpo1', 'High Res Sat', 0.95, true, 'https://images.unsplash.com/photo-1477959858617-67f85cf4f1df?auto=format&fit=crop&w=400&q=80'),
              createResult('bpo2', 'Urban Layout', 0.92, true, 'https://images.unsplash.com/photo-1519501025264-65ba15a82390?auto=format&fit=crop&w=400&q=80'),
              createResult('bpo3', 'Housing Grid', 0.89, true, 'https://images.unsplash.com/photo-1444723121867-7a241cacace9?auto=format&fit=crop&w=400&q=80'),
              createResult('bpo4', 'Densification', 0.87, true, 'https://images.unsplash.com/photo-1524661135-423995f22d0b?auto=format&fit=crop&w=400&q=80'),
              createResult('bpo5', 'Pattern', 0.86, true, 'https://images.unsplash.com/photo-1444723121867-7a241cacace9?auto=format&fit=crop&w=400&q=80')
            ]
          }
        }
      },
       {
        id: 'q2',
        type: "Text-to-Image",
        text: "Coastal line with mangrove forests",
        desc: "海岸线植被检索：需区分普通海滩与红树林特征。",
        results: {
          'clip-base': {
             baseline: [
              createResult('cb1', 'Beach', 0.60, false, 'https://images.unsplash.com/photo-1507525428034-b723cf961d3e?auto=format&fit=crop&w=400&q=80'),
              createResult('cb2', 'Blue Ocean', 0.55, false, 'https://images.unsplash.com/photo-1505118380757-91f5f5632de0?auto=format&fit=crop&w=400&q=80'),
              createResult('cb3', 'Vacation', 0.50, false, 'https://images.unsplash.com/photo-1519046904884-53103b34b206?auto=format&fit=crop&w=400&q=80'),
              createResult('cb4', 'Sky', 0.48, false, 'https://images.unsplash.com/photo-1520939819650-3e2d539cedca?auto=format&fit=crop&w=400&q=80'),
              createResult('cb5', 'Sand', 0.45, false, 'https://images.unsplash.com/photo-1471922694854-ff1b63b20054?auto=format&fit=crop&w=400&q=80')
            ],
            ours: [
              createResult('cbo1', 'Green Coast', 0.87, true, 'https://images.unsplash.com/photo-1520939819650-3e2d539cedca?auto=format&fit=crop&w=400&q=80'),
              createResult('cbo2', 'Vegetation', 0.82, true, 'https://images.unsplash.com/photo-1470071459604-3b5ec3a7fe05?auto=format&fit=crop&w=400&q=80'),
              createResult('cbo3', 'Marsh', 0.80, true, 'https://images.unsplash.com/photo-1504280390367-361c6d9f38f4?auto=format&fit=crop&w=400&q=80'),
              createResult('cbo4', 'Mangrove', 0.79, true, 'https://images.unsplash.com/photo-1448375240586-df4da7bc436e?auto=format&fit=crop&w=400&q=80'),
              createResult('cbo5', 'Wetlands', 0.76, true, 'https://images.unsplash.com/photo-1559128010-7c1ad6e1b6a5?auto=format&fit=crop&w=400&q=80')
            ]
          },
          'clip-large': {
             baseline: [
              createResult('cl1', 'Coast Aerial', 0.72, true, 'https://images.unsplash.com/photo-1520939819650-3e2d539cedca?auto=format&fit=crop&w=400&q=80'),
              createResult('cl2', 'Palm Trees', 0.65, false, 'https://images.unsplash.com/photo-1471922694854-ff1b63b20054?auto=format&fit=crop&w=400&q=80'),
              createResult('cl3', 'Island', 0.62, false, 'https://images.unsplash.com/photo-1559128010-7c1ad6e1b6a5?auto=format&fit=crop&w=400&q=80'),
              createResult('cl4', 'Sea', 0.60, false, 'https://images.unsplash.com/photo-1505118380757-91f5f5632de0?auto=format&fit=crop&w=400&q=80'),
              createResult('cl5', 'Resort', 0.58, false, 'https://images.unsplash.com/photo-1507525428034-b723cf961d3e?auto=format&fit=crop&w=400&q=80')
            ],
            ours: [
              createResult('clo1', 'Mangrove Pattern', 0.93, true, 'https://images.unsplash.com/photo-1520939819650-3e2d539cedca?auto=format&fit=crop&w=400&q=80'),
              createResult('clo2', 'Vegetation Index', 0.89, true, 'https://images.unsplash.com/photo-1470071459604-3b5ec3a7fe05?auto=format&fit=crop&w=400&q=80'),
              createResult('clo3', 'Estuary', 0.86, true, 'https://images.unsplash.com/photo-1504280390367-361c6d9f38f4?auto=format&fit=crop&w=400&q=80'),
              createResult('clo4', 'Swamp', 0.84, true, 'https://images.unsplash.com/photo-1448375240586-df4da7bc436e?auto=format&fit=crop&w=400&q=80'),
              createResult('clo5', 'Delta', 0.82, true, 'https://images.unsplash.com/photo-1559128010-7c1ad6e1b6a5?auto=format&fit=crop&w=400&q=80')
            ]
          },
          'blip': {
            baseline: [
              createResult('bp1', 'Swampy Coast', 0.78, true, 'https://images.unsplash.com/photo-1520939819650-3e2d539cedca?auto=format&fit=crop&w=400&q=80'),
              createResult('bp2', 'Forest', 0.65, false, 'https://images.unsplash.com/photo-1448375240586-df4da7bc436e?auto=format&fit=crop&w=400&q=80'),
              createResult('bp3', 'Lake', 0.60, false, 'https://images.unsplash.com/photo-1504280390367-361c6d9f38f4?auto=format&fit=crop&w=400&q=80'),
              createResult('bp4', 'Trees', 0.58, false, 'https://images.unsplash.com/photo-1470071459604-3b5ec3a7fe05?auto=format&fit=crop&w=400&q=80'),
              createResult('bp5', 'River', 0.55, false, 'https://images.unsplash.com/photo-1505118380757-91f5f5632de0?auto=format&fit=crop&w=400&q=80')
            ],
            ours: [
              createResult('bpo1', 'Mangrove Swamp', 0.96, true, 'https://images.unsplash.com/photo-1520939819650-3e2d539cedca?auto=format&fit=crop&w=400&q=80'),
              createResult('bpo2', 'Wetland', 0.92, true, 'https://images.unsplash.com/photo-1470071459604-3b5ec3a7fe05?auto=format&fit=crop&w=400&q=80'),
              createResult('bpo3', 'River Delta', 0.90, true, 'https://images.unsplash.com/photo-1504280390367-361c6d9f38f4?auto=format&fit=crop&w=400&q=80'),
              createResult('bpo4', 'Ecosystem', 0.88, true, 'https://images.unsplash.com/photo-1448375240586-df4da7bc436e?auto=format&fit=crop&w=400&q=80'),
              createResult('bpo5', 'Biodiversity', 0.86, true, 'https://images.unsplash.com/photo-1470071459604-3b5ec3a7fe05?auto=format&fit=crop&w=400&q=80')
            ]
          }
        }
      }
    ]
  },
  {
    id: 'industrial',
    domain: "Industrial Defect",
    icon: Cpu,
    queries: [
       {
        id: 'q1',
        type: "Text-to-Image",
        text: "Microchip surface scratch defect",
        desc: "细微划痕检测：通用模型常忽略细微纹理差异。",
        results: {
          'clip-base': {
            baseline: [
              createResult('cb1', 'Chip Generic', 0.45, false, 'https://images.unsplash.com/photo-1518770660439-4636190af475?auto=format&fit=crop&w=400&q=80'),
              createResult('cb2', 'PCB Board', 0.42, false, 'https://images.unsplash.com/photo-1555664424-778a1e5e1b48?auto=format&fit=crop&w=400&q=80'),
              createResult('cb3', 'Tech Art', 0.40, false, 'https://images.unsplash.com/photo-1597733336794-12d05021d510?auto=format&fit=crop&w=400&q=80'),
              createResult('cb4', 'Computer', 0.38, false, 'https://images.unsplash.com/photo-1592659762303-90081d34b277?auto=format&fit=crop&w=400&q=80'),
              createResult('cb5', 'Metal', 0.35, false, 'https://images.unsplash.com/photo-1580894908361-967195033215?auto=format&fit=crop&w=400&q=80')
            ],
            ours: [
              createResult('cbo1', 'Scratch Mark', 0.85, true, 'https://images.unsplash.com/photo-1580894908361-967195033215?auto=format&fit=crop&w=400&q=80'),
              createResult('cbo2', 'Surface Noise', 0.82, true, 'https://images.unsplash.com/photo-1581092918056-0c4c3acd3789?auto=format&fit=crop&w=400&q=80'),
              createResult('cbo3', 'Defect', 0.79, true, 'https://images.unsplash.com/photo-1592659762303-90081d34b277?auto=format&fit=crop&w=400&q=80'),
              createResult('cbo4', 'Microcrack', 0.76, true, 'https://images.unsplash.com/photo-1518770660439-4636190af475?auto=format&fit=crop&w=400&q=80'),
              createResult('cbo5', 'Fault', 0.74, true, 'https://images.unsplash.com/photo-1555664424-778a1e5e1b48?auto=format&fit=crop&w=400&q=80')
            ]
          },
          'clip-large': {
             baseline: [
              createResult('cl1', 'CPU Close', 0.65, true, 'https://images.unsplash.com/photo-1592659762303-90081d34b277?auto=format&fit=crop&w=400&q=80'),
              createResult('cl2', 'Processor', 0.60, false, 'https://images.unsplash.com/photo-1555664424-778a1e5e1b48?auto=format&fit=crop&w=400&q=80'),
              createResult('cl3', 'Silicon', 0.55, false, 'https://images.unsplash.com/photo-1518770660439-4636190af475?auto=format&fit=crop&w=400&q=80'),
              createResult('cl4', 'Tech', 0.52, false, 'https://images.unsplash.com/photo-1597733336794-12d05021d510?auto=format&fit=crop&w=400&q=80'),
              createResult('cl5', 'Macro', 0.50, false, 'https://images.unsplash.com/photo-1580894908361-967195033215?auto=format&fit=crop&w=400&q=80')
            ],
            ours: [
              createResult('clo1', 'Scratch Feature', 0.91, true, 'https://images.unsplash.com/photo-1580894908361-967195033215?auto=format&fit=crop&w=400&q=80'),
              createResult('clo2', 'Texture Anomaly', 0.89, true, 'https://images.unsplash.com/photo-1581092918056-0c4c3acd3789?auto=format&fit=crop&w=400&q=80'),
              createResult('clo3', 'Surface Defect', 0.86, true, 'https://images.unsplash.com/photo-1592659762303-90081d34b277?auto=format&fit=crop&w=400&q=80'),
              createResult('clo4', 'Flaw', 0.84, true, 'https://images.unsplash.com/photo-1555664424-778a1e5e1b48?auto=format&fit=crop&w=400&q=80'),
              createResult('clo5', 'Damage', 0.81, true, 'https://images.unsplash.com/photo-1518770660439-4636190af475?auto=format&fit=crop&w=400&q=80')
            ]
          },
          'blip': {
             baseline: [
              createResult('bp1', 'Metal Texture', 0.70, true, 'https://images.unsplash.com/photo-1580894908361-967195033215?auto=format&fit=crop&w=400&q=80'),
              createResult('bp2', 'Circuit', 0.65, false, 'https://images.unsplash.com/photo-1592659762303-90081d34b277?auto=format&fit=crop&w=400&q=80'),
              createResult('bp3', 'Hardware', 0.62, false, 'https://images.unsplash.com/photo-1555664424-778a1e5e1b48?auto=format&fit=crop&w=400&q=80'),
              createResult('bp4', 'Components', 0.58, false, 'https://images.unsplash.com/photo-1518770660439-4636190af475?auto=format&fit=crop&w=400&q=80'),
              createResult('bp5', 'Steel', 0.55, false, 'https://images.unsplash.com/photo-1597733336794-12d05021d510?auto=format&fit=crop&w=400&q=80')
            ],
            ours: [
              createResult('bpo1', 'Defect Pattern', 0.94, true, 'https://images.unsplash.com/photo-1580894908361-967195033215?auto=format&fit=crop&w=400&q=80'),
              createResult('bpo2', 'Anomaly', 0.92, true, 'https://images.unsplash.com/photo-1581092918056-0c4c3acd3789?auto=format&fit=crop&w=400&q=80'),
              createResult('bpo3', 'Fine Scratch', 0.90, true, 'https://images.unsplash.com/photo-1592659762303-90081d34b277?auto=format&fit=crop&w=400&q=80'),
              createResult('bpo4', 'Wear', 0.88, true, 'https://images.unsplash.com/photo-1555664424-778a1e5e1b48?auto=format&fit=crop&w=400&q=80'),
              createResult('bpo5', 'Abrasion', 0.85, true, 'https://images.unsplash.com/photo-1518770660439-4636190af475?auto=format&fit=crop&w=400&q=80')
            ]
          }
        }
      }
    ]
  }
];

// --- COMPONENTS ---

const ScoreBar = ({ score, isRelevant }) => {
  const percentage = Math.round(score * 100);
  let colorClass = 'bg-slate-300';
  
  // 动态调整颜色逻辑
  if (isRelevant) {
    colorClass = score > 0.8 ? 'bg-emerald-500' : 'bg-emerald-300';
  } else {
    colorClass = 'bg-rose-400';
  }

  return (
    <div className="mt-2 w-full">
      <div className="flex justify-between text-[10px] mb-1 font-mono text-slate-500">
        <span>Sim: {score.toFixed(3)}</span>
        <span>{percentage}%</span>
      </div>
      <div className="h-1.5 w-full bg-slate-100 rounded-full overflow-hidden">
        <div 
          className={`h-full rounded-full ${colorClass} transition-all duration-700 ease-out`} 
          style={{ width: `${percentage}%` }}
        ></div>
      </div>
    </div>
  );
};

const ResultCard = ({ item, rank }) => {
  // 定义排名的样式：前三名使用不同颜色，其余使用默认白底灰字
  const badgeColors = {
    1: 'bg-yellow-400 text-white shadow-yellow-200 border-yellow-300', // Gold
    2: 'bg-slate-400 text-white shadow-slate-200 border-slate-300',     // Silver
    3: 'bg-orange-400 text-white shadow-orange-200 border-orange-300',   // Bronze
    default: 'bg-white text-slate-500 shadow-slate-200 border-slate-200'
  };
  
  const badgeStyle = badgeColors[rank] || badgeColors.default;

  return (
    // 添加 mt-2 给徽章腾出一点顶部空间
    <div className="group relative bg-white p-2.5 rounded-xl border border-slate-200 shadow-sm hover:shadow-md transition-all duration-300 flex flex-col animate-in fade-in zoom-in duration-500 mt-2">
      
      {/* 明显的排名徽章 (Rank Badge) - 移至左上角外部 */}
      <div className={`absolute -top-3 -left-3 w-8 h-8 flex items-center justify-center rounded-full shadow-md z-20 font-extrabold text-sm border-2 ${badgeStyle}`}>
        {rank}
      </div>

      {/* 原有的相关性图标 (Relevant Indicator) */}
      {item.isRelevant ? (
        <div className="absolute top-2 right-2 text-emerald-600 bg-white/95 rounded-full p-0.5 shadow-sm z-10 border border-emerald-100">
          <CheckCircle size={14} />
        </div>
      ) : (
        <div className="absolute top-2 right-2 text-rose-500 bg-white/95 rounded-full p-0.5 shadow-sm z-10 border border-rose-100">
          <XCircle size={14} />
        </div>
      )}
      
      <div className="aspect-square overflow-hidden rounded-lg bg-slate-50 mb-2.5 relative">
         <div className="absolute inset-0 flex items-center justify-center text-slate-300 bg-slate-100 z-0">
            <Search size={24} opacity={0.2} />
         </div>
        <img 
          src={item.src} 
          alt={item.label} 
          className="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500 relative z-10"
          loading="lazy"
        />
      </div>
      
      <div className="mt-auto">
        <h4 className="text-[11px] font-semibold text-slate-700 truncate" title={item.label}>{item.label}</h4>
        <ScoreBar score={item.score} isRelevant={item.isRelevant} />
      </div>
    </div>
  );
};

const App = () => {
  // State: 当前选中的 Case (Domain)
  const [activeCaseIdx, setActiveCaseIdx] = useState(0);
  // State: 当前选中的 Query 索引 (相对于 activeCase)
  const [activeQueryIdx, setActiveQueryIdx] = useState(0);
  // State: 当前选中的 Baseline Model ID
  const [activeModelId, setActiveModelId] = useState('clip-base');
  
  const [isAnimating, setIsAnimating] = useState(false);

  // 获取当前数据上下文
  const activeCase = CASES[activeCaseIdx];
  // 确保 query 索引不越界
  const currentQueryIdx = activeQueryIdx >= activeCase.queries.length ? 0 : activeQueryIdx;
  const activeQuery = activeCase.queries[currentQueryIdx];
  
  // 获取当前选中的模型信息
  const activeBaselineModel = BASELINE_MODELS.find(m => m.id === activeModelId);

  // 从当前 Query 中获取对应模型的 Baseline 和 Ours 数据
  const currentResults = activeQuery.results[activeModelId] || { baseline: [], ours: [] };

  // 切换 Case
  const handleCaseChange = (idx) => {
    if (idx === activeCaseIdx) return;
    setIsAnimating(true);
    setTimeout(() => {
      setActiveCaseIdx(idx);
      setActiveQueryIdx(0); // Reset query to first one
      setIsAnimating(false);
    }, 300);
  };

  // 切换 Query
  const handleQueryNav = (direction) => {
    const len = activeCase.queries.length;
    let newIdx = direction === 'next' ? currentQueryIdx + 1 : currentQueryIdx - 1;
    if (newIdx < 0) newIdx = len - 1;
    if (newIdx >= len) newIdx = 0;
    
    setActiveQueryIdx(newIdx);
  };

  return (
    <div className="min-h-screen bg-slate-50 text-slate-800 font-sans">
      
      {/* Header */}
      <header className="bg-white border-b border-slate-200 sticky top-0 z-40 shadow-sm">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
          <div className="flex items-center gap-3">
            <div className="w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center text-white shadow-indigo-200 shadow-md">
              <Database size={18} />
            </div>
            <div>
              <h1 className="text-lg font-bold tracking-tight text-slate-900">MultiModal DA Vis</h1>
              <p className="text-[10px] text-slate-500 font-medium uppercase tracking-wider">Model Comparison Dashboard</p>
            </div>
          </div>
          <nav className="hidden md:flex items-center gap-6 text-sm font-medium text-slate-600">
            <div className="flex items-center gap-2 px-3 py-1 bg-slate-100 rounded-full text-xs">
               <span className="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></span>
               Live Demo
            </div>
          </nav>
        </div>
      </header>

      <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        {/* Title Section */}
        <div className="mb-8 flex flex-col md:flex-row md:items-end justify-between gap-4">
          <div>
            <h2 className="text-2xl font-bold text-slate-900">Retrieval Case Studies</h2>
            <p className="text-slate-500 mt-1">
              Top-5 retrieval comparison between <span className="font-semibold text-slate-700">Base Model</span> and <span className="font-semibold text-indigo-600">Adapted Model</span>.
            </p>
          </div>
          
          {/* Domain Selector Tabs */}
          <div className="flex bg-white p-1 rounded-xl border border-slate-200 shadow-sm">
            {CASES.map((c, idx) => {
              const Icon = c.icon;
              const isActive = activeCaseIdx === idx;
              return (
                <button
                  key={c.id}
                  onClick={() => handleCaseChange(idx)}
                  className={`
                    px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 flex items-center gap-2
                    ${isActive 
                      ? 'bg-indigo-50 text-indigo-700 shadow-sm ring-1 ring-indigo-200' 
                      : 'text-slate-500 hover:bg-slate-50 hover:text-slate-700'}
                  `}
                >
                  <Icon size={16} />
                  <span className="hidden sm:inline">{c.domain}</span>
                </button>
              );
            })}
          </div>
        </div>

        {/* Main Content Area */}
        <div className={`transition-opacity duration-300 ${isAnimating ? 'opacity-50' : 'opacity-100'}`}>
          
          {/* Query Controller Card */}
          <div className="bg-white rounded-2xl shadow-sm border border-slate-200 p-1 mb-8">
            <div className="flex flex-col md:flex-row">
              
              {/* Query Content */}
              <div className="flex-grow p-5 flex gap-5 items-start">
                 <div className="flex-shrink-0 mt-1">
                    <div className="w-10 h-10 rounded-full bg-indigo-50 flex items-center justify-center text-indigo-600 border border-indigo-100">
                      <Search size={20} />
                    </div>
                 </div>
                 <div className="w-full">
                    <div className="flex justify-between items-start mb-2">
                       <div className="flex items-center gap-2">
                         <span className="text-xs font-bold text-indigo-600 uppercase tracking-wider">Current Query</span>
                         <span className="px-2 py-0.5 rounded text-[10px] bg-slate-100 text-slate-500 border border-slate-200 font-mono">
                           {activeQuery.type}
                         </span>
                       </div>
                       <span className="text-xs text-slate-400 font-mono">
                          ID: {activeQuery.id}
                       </span>
                    </div>
                    
                    <div className="flex flex-col sm:flex-row gap-4 items-start sm:items-center">
                      {activeQuery.queryImage && (
                        <img src={activeQuery.queryImage} alt="Query" className="w-16 h-16 rounded-lg object-cover border border-slate-200 shadow-sm" />
                      )}
                      <div>
                        <h3 className="text-lg font-medium text-slate-900 leading-tight">"{activeQuery.text}"</h3>
                        <p className="text-sm text-slate-500 mt-1">{activeQuery.desc}</p>
                      </div>
                    </div>
                 </div>
              </div>

              {/* Query Navigation Controls */}
              <div className="border-t md:border-t-0 md:border-l border-slate-100 p-4 flex md:flex-col items-center justify-center gap-3 bg-slate-50/50 rounded-b-2xl md:rounded-r-2xl md:rounded-bl-none w-full md:w-auto min-w-[140px]">
                <span className="text-xs font-medium text-slate-500 uppercase tracking-wider mb-0 md:mb-1">
                   Query {currentQueryIdx + 1} / {activeCase.queries.length}
                </span>
                <div className="flex items-center gap-2">
                  <button 
                    onClick={() => handleQueryNav('prev')}
                    className="p-2 rounded-lg bg-white border border-slate-200 text-slate-600 hover:bg-indigo-50 hover:text-indigo-600 hover:border-indigo-200 transition-colors shadow-sm"
                    title="Previous Query"
                  >
                    <ChevronLeft size={20} />
                  </button>
                  <button 
                    onClick={() => handleQueryNav('next')}
                    className="p-2 rounded-lg bg-white border border-slate-200 text-slate-600 hover:bg-indigo-50 hover:text-indigo-600 hover:border-indigo-200 transition-colors shadow-sm"
                    title="Next Query"
                  >
                    <ChevronRight size={20} />
                  </button>
                </div>
              </div>
            </div>
          </div>

          {/* Main Model Selection Tabs */}
          <div className="mb-6 bg-white p-2 rounded-xl border border-slate-200 shadow-sm flex flex-wrap items-center justify-between gap-4">
             <div className="flex items-center gap-3 px-2">
                <div className="p-1.5 bg-slate-100 text-slate-600 rounded-md">
                   <Cpu size={18} />
                </div>
                <div>
                   <span className="text-xs font-bold text-slate-400 uppercase tracking-wide block">Base Model Selection</span>
                   <span className="text-sm font-medium text-slate-800">Choose backbone to compare</span>
                </div>
             </div>
             <div className="flex bg-slate-100 p-1 rounded-lg">
                {BASELINE_MODELS.map(m => (
                  <button
                    key={m.id}
                    onClick={() => setActiveModelId(m.id)}
                    className={`
                      px-4 py-2 rounded-md text-sm font-medium transition-all
                      ${activeModelId === m.id 
                        ? 'bg-white text-indigo-600 shadow-sm font-bold ring-1 ring-black/5' 
                        : 'text-slate-500 hover:text-slate-700 hover:bg-slate-200/50'}
                    `}
                  >
                    {m.name}
                  </button>
                ))}
             </div>
          </div>

          {/* Vertical Layout Container */}
          <div className="flex flex-col gap-8">
            
            {/* Top Row: Original Base Model */}
            <div className="flex flex-col animate-in slide-in-from-top-4 duration-500">
               <div className="bg-white border border-slate-200 border-b-0 rounded-t-xl p-4 flex items-center justify-between">
                  <div className="flex items-center gap-2">
                    <div className="p-1.5 bg-slate-100 text-slate-600 rounded-md">
                      <Layers size={16} />
                    </div>
                    <div>
                      <h3 className="text-sm font-bold text-slate-800">Original {activeBaselineModel.name} (Top-5)</h3>
                      <p className="text-[10px] text-slate-500">Pre-trained weights (Zero-shot)</p>
                    </div>
                  </div>
                  <div className="px-2 py-1 bg-slate-100 rounded text-xs font-mono text-slate-500">
                     Baseline
                  </div>
               </div>

               <div className="bg-slate-50 border border-slate-200 rounded-b-xl p-5">
                 {/* Updated Grid for 5 items */}
                 <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4">
                   {currentResults.baseline.map((item, i) => (
                     <ResultCard key={item.id} item={item} rank={i + 1} />
                   ))}
                   {currentResults.baseline.length === 0 && (
                      <div className="col-span-full text-center py-12 text-slate-400">
                        No baseline data available.
                      </div>
                   )}
                 </div>
               </div>
            </div>

            {/* Vertical Flow Arrow */}
            <div className="flex justify-center -my-4 z-10">
               <div className="bg-white border border-slate-200 p-2 rounded-full text-indigo-400 shadow-sm">
                 <ArrowDown size={24} />
               </div>
            </div>

            {/* Bottom Row: Fine-tuned Model (Ours) */}
            <div className="flex flex-col animate-in slide-in-from-bottom-4 duration-500">
               <div className="bg-indigo-600 border border-indigo-600 border-b-0 rounded-t-xl p-4 flex items-center justify-between text-white">
                  <div className="flex items-center gap-2">
                    <div className="p-1.5 bg-white/20 text-white rounded-md backdrop-blur-sm">
                      <Aperture size={16} />
                    </div>
                    <div>
                      <h3 className="text-sm font-bold">Fine-tuned {activeBaselineModel.name} (Top-5)</h3>
                      <p className="text-[10px] text-indigo-100">Adapted via our method</p>
                    </div>
                  </div>
                  <div className="px-3 py-1 bg-emerald-400/20 border border-emerald-400/30 text-emerald-50 rounded-full text-xs font-bold backdrop-blur-sm flex items-center gap-1">
                     <CheckCircle size={12} />
                     Ours (Improved)
                  </div>
               </div>

               <div className="bg-indigo-50/50 border border-indigo-100 border-t-0 rounded-b-xl p-5 relative overflow-hidden">
                 <div className="absolute top-0 right-0 w-32 h-32 bg-gradient-to-bl from-indigo-100/50 to-transparent rounded-bl-full pointer-events-none"></div>
                 
                 {/* Updated Grid for 5 items */}
                 <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4 relative z-10">
                   {currentResults.ours.map((item, i) => (
                     <ResultCard key={item.id} item={item} rank={i + 1} />
                   ))}
                   {currentResults.ours.length === 0 && (
                      <div className="col-span-full text-center py-12 text-indigo-300">
                        No adapted data available.
                      </div>
                   )}
                 </div>
               </div>
            </div>

          </div>

        </div>
      </main>
    </div>
  );
};

export default App;